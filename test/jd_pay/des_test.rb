require 'test_helper'

class JdPay::DesTest < Minitest::Test
  def setup
    @decrypted_str = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><jdpay><version>V2.0</version><merchant>22294531</merchant><result><code>000000</code><desc>成功</desc></result><tradeNum>1494236491939_r</tradeNum><oTradeNum>1494236491939</oTradeNum><amount>1</amount><currency>CNY</currency><tradeTime>20170508180239</tradeTime><note></note><status>1</status><sign>W4g4PwHlh7OM60uz72MYH4+5PW1lJyFoHiKGFczOGDHdATqAAqbRy4p+sXU04FlsA29UpEfY3Fsct1IAhL5D7y1/tgZDRB+tGe1Tm0zTeFcKQjV8UU7bfRC+Mi3OdQgQvJ2JIIJcsxpXyQmeG2Vr/77aPhCY8hNEQObDp8fDDFc=</sign></jdpay>"
    @encrypted_str = "ZDg2ZmU3YTk5YmM2MGQxYzhjNjc0YmY1ZWJlY2QyODU0YTc5NmQ3ZWQxMWU1NzE3MWQ0OTUwOGI5NzllYmE4ZjM1YzRiZjlmYWE1M2ZiYjVjYTg5YjA4NTdhMjg3NTBhNzQxM2ZjOWFlN2U3YTNlYzM5ZTI5OTBkZDczNzQ5MjhjM2UxMjhkYWJhMGM0NWY2MWFjYjg2YWFlZDBjOTQ1Y2UyOWNlMDg2MmViOTQ3ZDUyZTczOTMxYjM0NGQwZTNjZGVjZTNkY2EwZmZlYzZlODE1Njc3YWMzODcyNTRhYTcyZDc5MjNhYzc5YWIzZGM0ZGIwYWE4NTc3ZTRhNmE3YmMxMjIwMmEyZmRjMDgxNjhlZjQ5ODVlNGIwNmU2ZTVjZjk3MWRlMmQ5NWYxMmJjNjQ3ZTY3MzhhNzRlOGJlMThmMGU3NDhmMmFiMWIwNDlmMGE5NmRjZWU5YTRiZDdkZGVjMDI2YjE2ZDI0M2MzMzEzNWI5ZDkyYzQ3OTU4OTc2NmQ0NmEyMGU2MTU3YTc4ZTUxY2UyMTYxMWNhMGFlMmIxZGJiOTEwZWM1OGJkMjU0ODA3NTYxYjI1N2EzYjFhNzVmMDI2ZTkxMmQ1ZGZiOGY2ZGQ2NDQwODBmMjM4ZGI2MjNkOTUxY2NhNzRjN2ZhMDg5M2EzM2I0ZmU4MTA0MjAyZmVjNGVkNjIzNjk2ODBkNWYwYzZmYzA1YjIwYmU3MDY2Y2E5NjI0N2I1MGE4MTlhM2U0MThmMDQ1MWU3ZjhkMzQwOGQ5MmZkM2RlN2FjODhiODEyODEwMzY0NjVhYjBmMTk1MjVjNzc5YTQ5Y2Q5ZjliNWViODRjOTEyNjQyYTFkZGQ5MzRiYjc3YjAzMTY5YTdkNGQ4ZDEzYjk3OGY0NmNiZjFmNjM3NzM4NGYwMDExNTIwODM0MWEyYTg1ZGYxNDdjZGRmMTk0ZjlmNDQ0ODM0MzQ2NjgzYmFlNzg4NjE0MWViODUwYTdjNjYyZjdjY2QyNGFlM2Q3ZmQ4NDkwNzZmMWNiMWFmODczNDNhZDcwN2M1NTE2ODFhZDA3NzE3OTU3NDg0Yzk4NTIzNTQ5YTM4YzI1MDIxZTJmNmIxODE1NDA0YTczZjMzMGEzMTgzMGNjYzQ1YjI2ZTUzNzFiODMzMjU1ZjllZjNmYjVhNzIwNDc5Y2UzNTM2OGQ0ZWQ5ZDRlYjllOTE2MTQ0OTdiN2Y3Njc2M2E5ZjRlY2I4ZGNhYWFlNTE3MjJhYTBmM2Y4YjAwZWRkYTFhODI1ZTAxYzBhZTkzM2NiMTYwM2ExZmJmYjc5OTZhYjM5ZjA3YmVkYTgxNDQyODkxNDEyYWZjZjhiODA3YmQyNDc4Mzg1MGZlNGE5ZDc1NzlmOGU4MjIzZDEwYjhkNzI0ZmVmNmU4YzQyZDNkNDUxYTI3MWVmMw=="
  end

  def test_encrypt_3des
    assert_equal @encrypted_str, Base64.strict_encode64(JdPay::Des.encrypt_3des @decrypted_str)
  end

  def test_decrypt_3des
    assert_equal @decrypted_str, JdPay::Des.decrypt_3des(Base64.decode64 @encrypted_str)
  end
end
